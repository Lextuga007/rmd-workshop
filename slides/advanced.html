<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R Markdown Advanced</title>
    <meta charset="utf-8" />
    <meta name="author" content="Zo√´ Turner" />
    <meta name="date" content="2022-03-23" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/my-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">








class: title-slide, center, middle

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #ffffffcc;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#e7553c;"&gt;02&lt;/strong&gt;
&lt;/span&gt; 


# R Markdown Advanced

## Adapted from slides by Alison Hill

### Zo√´ Turner

#### [https://philosopher-analyst.netlify.app/rmd-workshop/](https://philosopher-analyst.netlify.app/rmd-workshop/)

&lt;!--
head notes
output formats to html- 
-demo cross references for headers, figures, and tables made with kable
-cover here render from command line and go deeper into looping over parameters as well as output formats
--&gt;

layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;https://philosopher-analyst.netlify.app/rmd-workshop/&lt;/span&gt;&lt;/div&gt;


---





.left-column[
&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #f2e255;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color: #fff;"&gt;?&lt;/strong&gt;
&lt;/span&gt; 
]

.right-column[

# How does R Markdown work - what do you think?

1. ü§∑

1. I press knit, a document appears, and I believe that anything happening in between could be actual magic.

1. `knitr` executes the code and converts `.Rmd` to `.md`; **Pandoc** renders the `.md` file to the output format you want.

]

---
class: top

.left-column[
&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #f2e255;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color: #fff;"&gt;?&lt;/strong&gt;
&lt;/span&gt; 

]


.right-column[

# How *does* R Markdown work?

1. ü§∑ (‚úîÔ∏è)

1. ["I press knit, a document appears, and I believe that anything happening in between could be actual magic."](https://twitter.com/allison_horst/status/1070323369600442368?s=20) (üßô‚Äç‚ôÇÔ∏è)

1. `knitr` executes the code and converts `.Rmd` to `.md`; **Pandoc** renders the `.md` file to the output format you want. (‚úîÔ∏è)

]

---
class: middle, center

&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/rmarkdown.png" width="25%" style="display: block; margin: auto;" /&gt;


&gt; "In a nutshell, R Markdown stands on the shoulders of `knitr` and **Pandoc**.

--

&gt; The former executes the computer code embedded in Markdown, and converts R Markdown to Markdown.

--

&gt; The latter renders Markdown to the output format you want (such as PDF, HTML, Word, Slides, website and so on)."

--

&gt; &amp;mdash; [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)

---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#17a2b8;"&gt;1 &lt;/strong&gt;
&lt;/span&gt; 

--


# Output formats

---
class: middle, center

&lt;img src="images/outputs.png" width="50%" /&gt;

???

Built in formats (in the `rmarkdown` package)

versus

extensions (different packages that extend output formats available to you)

---
class: middle, center


&lt;a href="https://rmarkdown.rstudio.com/docs/reference/index.html#section-output-formats" target="_blank"&gt;&lt;img src="images/rmdbase-formats.png" width="40%" /&gt;&lt;/a&gt;

https://rmarkdown.rstudio.com/docs/reference/index.html#section-output-formats

---
class: your-turn

# Your turn

## Use a different built-in format

.pull-left[

Use the drop-down menu for the üß∂ **Knit** button and try:

1. Knit to Word

1. Knit to PDF

]

.pull-right[
&lt;img src="images/knit-dropdown.png" width="60%" style="display: block; margin: auto;" /&gt;

]

<div class="countdown" id="timer_623b5d66" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---

# Temp check üå°

Do you have new output formats in your YAML?

```yaml
---
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
  word_document:
    toc: true
  pdf_document:
    toc: true
---
```

???

This is a great way to "control" your knit button!

Notice that when you knit, it respects those output options in your YAML.

This way you "save" your output options


---

# What is hard about YAML?

.pull-left[
![](https://media.giphy.com/media/Nt2cPxzpKhbCE/giphy.gif)
]

.pull-right[
+ Indentations matter

+ Rarely informative error messages

+ Knowing which output options are relevant for different formats (i.e., Word, PDF, HTML, etc.)

+ Easy to forget the right `key`

+ Easy to forget the possible `values` for a given `key`
]

---
class: your-turn

# Your turn

## Use an extension package

.pull-left[

1. Edit your YAML again! Change the `output:` key to only `bookdown::html_document2` 

1. Save the document; click on the dropdown üß∂ **Knit** button- what do you notice?

1. üß∂ **Knit** to html_document2.

]

.pull-right[
```yaml
---
output:
  bookdown::html_document2:
    toc: true
    toc_float: true
    theme: flatly
---
```
]



<div class="countdown" id="timer_623b5d3e" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


.footnote[(note: this requires you to install the [`bookdown` package](https://bookdown.org/yihui/bookdown/) on your own computer)]

---
class: live-code

# Adding figure auto-numbering &amp; captions

Together we:

1. Label that chunk

1. Add a cross-reference like see Figure `\@ref(fig:pretty-plot)`

1. Try with `finale-scatterplot` code chunk: see Figure `\@ref(fig:finale-scatterplot)` (watch what happens if try to cross-reference without a caption!)

.footnote[Cross-referencing only works in these output packages: distill, bookdown, blogdown]

---
class: your-turn

# Your turn

## Use another extension package


1. Edit your YAML again! Add the output format `distill::distill_article` 

1. Save the document; click on the dropdown üß∂ **Knit** button- what do you notice?

1. üß∂ **Knit** to distill_article.

**If this was easy**, add a table of contents too.

_psst...answers on the next slide..._

<div class="countdown" id="timer_623b5d11" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


.footnote[(note: this requires you to install the [`distill` package](https://rstudio.github.io/distill/) on your own computer)]

???

At this point, I'm going to stick with the distill_article output format for the rest of this session.

---
class: your-turn

# Your turn

## Answer


```yaml
---
output:
  distill::distill_article:
    toc: true
---
```


---
class: middle

# Pop quiz

.pull-left[
How do you add a single output **format** to your YAML?

```yaml
---
output: html_document: default
---
output: html_document
---
```

]

--

.pull-right[
How do you add an output **option** to a format in your YAML?

```yaml
---
output: 
  html_document: 
    toc: true
---
output: 
  html_document(toc=true)
---
```

]

---
class: middle

# Pop quiz

.pull-left[
How do you add another output **format** to your YAML?

```yaml
---
output: 
  html_document: default
  word_document: default
---
output: 
  html_document()
  word_document()
---
```

]

--


.pull-right[
How do you now add output **options** to your YAML?

```yaml
---
output: 
  html_document: 
    toc: true
  word_document: default
---
output: 
  html_document(toc=true)
  word_document(default)
---
```

]


---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#17a2b8;"&gt;2 &lt;/strong&gt;
&lt;/span&gt; 

--

# Command line


---
class: middle, center

# Rendering

.pull-left[

So far: üß∂

]

.pull-right[

```r
render("02-bakeoff-finales.Rmd")
```

]
---
class: your-turn

# Your turn

Instead of using the "Knit" button, try running this code in your R console:


```r
library(rmarkdown) # needs to be loaded first
render("02-bakeoff-finales.Rmd")
```


Now try changing the parameters:


```r
render("02-bakeoff-finales.Rmd",
       params = list(series = "9"))
```

__If this was easy__, play with the other parameters too. Or see if you can change the output format, and add output options.

_psst...answers on the next slide..._


<div class="countdown" id="timer_623b5ecc" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn

# Answer


```r
render("02-bakeoff-finales.Rmd",
       params = list(series = "9"), 
       output_format = distill::distill_article(toc = TRUE))
```


---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#17a2b8;"&gt;3 &lt;/strong&gt;
&lt;/span&gt; 

--

# Render loops


---
class: live-code

# We loop together



```r
# the setup
series &lt;- sort(unique(ratings$series))

# the loop
for (this_series in series) {
  render("02-bakeoff-finales.Rmd",
         params = list(series = this_series))
}
```

_psst...the wrong way_

---

&lt;img src="images/joy-of-fp/forloops.png" width="80%" style="display: block; margin: auto;" /&gt;


---

# We need two things

For the `rmarkdown::render()` function to work they way we want:

1. The list of series -&gt; `params`

1. The name of each report -&gt; `output_file`

We could do this with a loop, but let's start **purrr**ing...

---
class: center, middle, inverse

&gt; "Of course someone has to write **loops**. 

&gt; It doesn't have to be _you_.

&gt; &amp;mdash; Jenny Bryan

---

&lt;img src="images/joy-of-fp/map_frosting.png" width="7825" style="display: block; margin: auto;" /&gt;

---

&lt;img src="images/joy-of-fp/map2_cupcakes.png" width="7825" style="display: block; margin: auto;" /&gt;


---

# Rendering multiple reports


```r
# the setup

paths &lt;- paste0("series-", series)

# series needs to be a list
series &lt;- sort(unique(ratings$series))
params &lt;- map(series, ~ list(series = .x))
str(params)
```


```r
walk2(
  paths, params,
  ~ rmarkdown::render("02-bakeoff-finales.Rmd", output_file = .x, params = .y)
)
```


---
class: your-turn

# Your turn

Try to get this set-up working locally for you.


```r
# the setup

paths &lt;- paste0("series-", series)

# series needs to be a list
series &lt;- sort(unique(ratings$series))
params &lt;- map(series, ~ list(series = .x))
str(params)
```


```r
walk2(
  paths, params,
  ~ rmarkdown::render("02-bakeoff-finales.Rmd", output_file = .x, params = .y)
)
```

<div class="countdown" id="timer_623b5d06" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: live-code

# Digging deeper

So now the output file name changed, but we can go deeper.

Let's say we'd also like the change the title in our YAML.

Let's do this together.

(make sure the below is in quotes)

```yaml
---
title: The Great British Bake Off, Series `r params$series`
---
```

---
class: your-turn

# Your turn

Use your render script again and check to make sure that the titles now have the series number in them. 

It is good practice to save your rendering script in the project, call it `_render.R`.

<div class="countdown" id="timer_623b5d48" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: middle, center

# üç±

# Time for lunch!

<div class="countdown blink-colon noupdate-15" id="timer_623b5be7" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">60</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "dracula",
"highlightLanguage": ["r", "yaml", "markdown"],
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
